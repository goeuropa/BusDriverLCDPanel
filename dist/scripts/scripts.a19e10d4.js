"use strict";angular.module("rasp2App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("rasp2App").service("SettingsService",["$http","$q",function(a,b){this.agencyid=20,this.nrboczny=5070,this.line_id=this.agencyid+"_"+this.nrboczny,this.epsilon=3,this.postoj=20,this.apiUrl="https://beta.kiedybus.pl/onebusaway-webapp-production/api/where/",this.setNrBoczny=function(a){this.nrboczny=a,this.line_id=this.agencyid+"_"+this.nrboczny}}]),angular.module("rasp2App").controller("MainCtrl",["$scope","$http","$q","SettingsService",function(a,b,c,d){a.agencyid=d.agencyid,a.nrboczny=d.nrboczny,a.line_id=a.agencyid+"_"+a.nrboczny,a.epsilon=d.epsilon,a.postoj=d.postoj,a.apiUrl=d.apiUrl,a.nrlinii="_",a.nastprzystanek="_",a.przysp="_",a.kierunek="_",a.najblprzystanek="_",a.najblprzystanekoffset="_",a.isConnectionAndVehicle=!1,a.delay=1;var e={};a.odswiez=function(){var d=[];d.push(b.get(a.apiUrl+"vehicles-for-agency/"+a.agencyid+".json?key=web")),c.all(d).then(function(d){for(var f=0;f<d[0].data.data.list.length;f++)a.hasVehicle(d[0].data.data.list[f])?a.getDataVehiclesForAgency(d[0].data.data.list[f]):a.isConnectionAndVehicle=!1;for(var f=0;f<d[0].data.data.references.stops.length;f++)a.hasNextStop(d[0].data.data.references.stops[f],e.next_stop_id)&&(a.getDataReferencesNextStopForAgency(d[0].data.data.references.stops[f]),a.isConnectionAndVehicle=!0);for(var f=0;f<d[0].data.data.references.stops.length;f++)a.hasClosestStop(d[0].data.data.references.stops[f],e.closest_stop_id)&&a.getDataReferencesClosestStopForAgency(d[0].data.data.references.stops[f]);var g=[];g.push(b.get(a.apiUrl+"trip/"+e.trip_id+".json?key=web")),c.all(g).then(function(b){e.direction=b[0].data.data.entry.tripHeadsign,e.line_number=b[0].data.data.entry.routeId,a.update_current_data(e)})})},setInterval(function(){a.odswiez()},3e3),a.hasVehicle=function(b){return b.vehicleId==a.line_id?!0:!1},a.extractLine=function(b){var c=a.agencyid.toString().length;return b.toString().substring(c+1,b.toString().length)},a.update_current_data=function(b){a.nrlinii=a.extractLine(b.line_number),a.kierunek=b.direction,a.nastprzystanek=b.next_stop_name,a.updateDelay(b.next_stop_offset),a.przysp=b.next_stop_offset,a.najblprzystanek=b.closest_stop_name,a.najblprzystanekoffset=b.closest_stop_offset,a.updateDelayClosest(b.closest_stop_offset)},a.onTime=function(b){return parseInt(b)>-1*parseInt(a.epsilon)&&parseInt(b)<parseInt(a.epsilon)?!0:!1},a.onTimeClosest=function(b){return parseInt(b)>-1*parseInt(a.postoj)&&parseInt(b)<parseInt(a.postoj)?!0:!1},a.tooEarly=function(a){return parseInt(a)<0?!0:!1},a.tooLate=function(a){return parseInt(a)>0?!0:!1},a.updateDelay=function(b){1==a.onTime(b)?a.delay="ok":1==a.tooLate(b)?a.delay="late":1==a.tooEarly(b)&&(a.delay="early")},a.updateDelayClosest=function(b){1==a.onTimeClosest(b)?a.delayClosest="ok":1==a.tooLate(b)?a.delayClosest="late":1==a.tooEarly(b)&&(a.delayClosest="early")},a.getDataVehiclesForAgency=function(a){e.next_stop_id=a.tripStatus.nextStop,e.closest_stop_id=a.tripStatus.closestStop,e.trip_id=a.tripId,e.next_stop_offset=a.tripStatus.scheduleDeviation,e.closest_stop_offset=a.tripStatus.closestStopTimeOffset},a.hasNextStop=function(a,b){return a.id==b?!0:!1},a.hasClosestStop=function(a,b){return a.id==b?!0:!1},a.getDataReferencesNextStopForAgency=function(a){e.next_stop_name=a.name},a.getDataReferencesClosestStopForAgency=function(a){e.closest_stop_name=a.name}}]),angular.module("rasp2App").controller("SettingsCtrl",["$scope","$http","$q","SettingsService",function(a,b,c,d){a.nrboczny=d.nrboczny,a.tolerancja=d.epsilon,a.postoj=d.postoj,a.updateData=function(){d.setNrBoczny(a.nrboczny),d.epsilon=a.tolerancja,d.postoj=a.postoj}}]),angular.module("rasp2App").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]);